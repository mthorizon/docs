<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="/initializeTheme.iife.js"></script>
    
    <title data-react-helmet="true">Mint Collectibles Using a Gasless Serverless Transactions API – Sequence</title>
    <meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="Mint Collectibles Using a Gasless Serverless Transactions API"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/>
    <link data-react-helmet="true" rel="icon" href="/img/favicon.ico" type="image/x-icon"/><link data-react-helmet="true" rel="icon" href="/img/favicon.ico" type="image/x-icon" media="(prefers-color-scheme: dark)"/>
    
    
    
  
    <script type="module" crossorigin src="/assets/index-Cpb5byZC.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/style-BGOAID0Z.css">
  </head>
  <body>
    <div id="app"><div class="vocs_DocsLayout" data-layout="docs"><a class="vocs_SkipLink vocs_utils_visuallyHidden" href="/guides/mint-collectibles-serverless#vocs-content">Skip to content</a><div class="vocs_DocsLayout_gutterLeft"><aside class="vocs_Sidebar vocs_DocsLayout_sidebar"><div class="vocs_Sidebar_logoWrapper"><div class="vocs_Sidebar_logo"><a style="align-items:center;display:flex;height:100%" href="/"><img alt="Logo" class="vocs_NavLogo_logoImage vocs_Logo vocs_Logo_logoDark" src="/img/sequence-composite-dark.svg"/><img alt="Logo" class="vocs_NavLogo_logoImage vocs_Logo vocs_Logo_logoLight" src="/img/sequence-composite-light.svg"/></a></div><div class="vocs_Sidebar_divider"></div></div><nav class="vocs_Sidebar_navigation"><div class="vocs_Sidebar_group"><section class="vocs_Sidebar_section vocs_Sidebar_level"><div class="vocs_Sidebar_sectionHeader" role="button" tabindex="0"><div class="vocs_Sidebar_sectionTitle">Guides</div><div role="button" tabindex="0"><div aria-label="toggle section" class="vocs_Icon vocs_Sidebar_sectionCollapse" role="img" style="--vocs_Icon_size:10px"><svg width="100%" height="100%" viewBox="0 0 39 69" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Chevron Right</title><path d="M38.8697 34.7461C38.8697 33.6719 38.4791 32.6953 37.649 31.8652L7.47318 1.8848C6.74078 1.1035 5.76418 0.712891 4.64118 0.712891C2.34618 0.712891 0.588379 2.42189 0.588379 4.71679C0.588379 5.79099 1.07668 6.81639 1.76028 7.59769L29.0552 34.7461L1.76028 61.8945C1.07668 62.6758 0.588379 63.6523 0.588379 64.7754C0.588379 67.0703 2.34618 68.7793 4.64118 68.7793C5.76418 68.7793 6.74078 68.3887 7.47318 67.6074L37.649 37.627C38.4791 36.7969 38.8697 35.8203 38.8697 34.7461Z" fill="currentColor"></path></svg></div></div></div><div class="vocs_Sidebar_items"><a data-active="false" class="vocs_Sidebar_item" href="/guides/webgl-guide">Build a Game with WebGL</a><a data-active="false" class="vocs_Sidebar_item" href="/guides/unity-guide">Build a Unity Game</a><a data-active="true" class="vocs_Sidebar_item" href="/guides/mint-collectibles-serverless">Build a Collectible Minting Service</a><a data-active="false" class="vocs_Sidebar_item" href="/guides/metadata-guide">Manage Collection Metadata</a><a data-active="false" class="vocs_Sidebar_item" href="/guides/treasure-chest-guide">Build a Treasure Chest with AI Minting</a><a data-active="false" class="vocs_Sidebar_item" href="/guides/building-relaying-server">Build a Backend Transaction Service</a><a data-active="false" class="vocs_Sidebar_item" href="/guides/analytics-guide">Leverage Sequence Analytics API in Dune</a><a data-active="false" class="vocs_Sidebar_item" href="/guides/linked-wallets-guide">Build an Embedded Wallet Linking Service</a><a data-active="false" class="vocs_Sidebar_item" href="/guides/custom-marketplace">Build a Custom Marketplace</a></div></section><section class="vocs_Sidebar_section"><div class="vocs_Sidebar_items"><a data-active="false" class="vocs_Sidebar_item" href="/guides/template-overview">Templates</a></div></section></div></nav></aside></div><div class="vocs_DocsLayout_gutterTop vocs_DocsLayout_gutterTop_offsetLeftGutter"><div class="vocs_DesktopTopNav"><button class="vocs_DesktopSearch_search" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:Rlj:" data-state="closed"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-top:2px"><path d="M10 6.5C10 8.433 8.433 10 6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5ZM9.30884 10.0159C8.53901 10.6318 7.56251 11 6.5 11C4.01472 11 2 8.98528 2 6.5C2 4.01472 4.01472 2 6.5 2C8.98528 2 11 4.01472 11 6.5C11 7.56251 10.6318 8.53901 10.0159 9.30884L12.8536 12.1464C13.0488 12.3417 13.0488 12.6583 12.8536 12.8536C12.6583 13.0488 12.3417 13.0488 12.1464 12.8536L9.30884 10.0159Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg>Search<div class="vocs_DesktopSearch_searchCommand"><div style="background:currentColor;transform:rotate(45deg);width:1.5px;border-radius:2px;height:100%"></div></div></button><div class="vocs_DesktopTopNav_logoWrapper"><div class="vocs_DesktopTopNav_logo"><a style="align-items:center;display:flex;height:56px;margin-top:4px" href="/"><img alt="Logo" class="vocs_NavLogo_logoImage vocs_Logo vocs_Logo_logoDark" src="/img/sequence-composite-dark.svg"/><img alt="Logo" class="vocs_NavLogo_logoImage vocs_Logo vocs_Logo_logoLight" src="/img/sequence-composite-light.svg"/></a></div></div><div class="vocs_DesktopTopNav_section"></div><div class="vocs_DesktopTopNav_section"><div class="vocs_DesktopTopNav_group"><nav aria-label="Main" data-orientation="horizontal" dir="ltr" class="vocs_NavigationMenu"><div style="position:relative"><ul data-orientation="horizontal" class="vocs_NavigationMenu_list" dir="ltr"><li class="vocs_DesktopTopNav_item vocs_NavigationMenu_item"><button id="radix-:Rm5j:-trigger-radix-:R6m5j:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rm5j:-content-radix-:R6m5j:" data-active="false" class="vocs_NavigationMenu_trigger vocs_NavigationMenu_link" style="--vocs_NavigationMenu_chevronDownIcon:url(/.vocs/icons/chevron-down.svg)" data-radix-collection-item="">Solutions</button></li><li class="vocs_DesktopTopNav_item vocs_NavigationMenu_item"><button id="radix-:Rm5j:-trigger-radix-:Ram5j:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rm5j:-content-radix-:Ram5j:" data-active="false" class="vocs_NavigationMenu_trigger vocs_NavigationMenu_link" style="--vocs_NavigationMenu_chevronDownIcon:url(/.vocs/icons/chevron-down.svg)" data-radix-collection-item="">Resources</button></li><li class="vocs_DesktopTopNav_item vocs_NavigationMenu_item"><button id="radix-:Rm5j:-trigger-radix-:Rem5j:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rm5j:-content-radix-:Rem5j:" data-active="false" class="vocs_NavigationMenu_trigger vocs_NavigationMenu_link" style="--vocs_NavigationMenu_chevronDownIcon:url(/.vocs/icons/chevron-down.svg)" data-radix-collection-item="">SDKs</button></li><li class="vocs_DesktopTopNav_item vocs_NavigationMenu_item"><button id="radix-:Rm5j:-trigger-radix-:Rim5j:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rm5j:-content-radix-:Rim5j:" data-active="false" class="vocs_NavigationMenu_trigger vocs_NavigationMenu_link" style="--vocs_NavigationMenu_chevronDownIcon:url(/.vocs/icons/chevron-down.svg)" data-radix-collection-item="">APIs</button></li><li class="vocs_DesktopTopNav_item vocs_NavigationMenu_item"><button id="radix-:Rm5j:-trigger-radix-:Rmm5j:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rm5j:-content-radix-:Rmm5j:" data-active="false" class="vocs_NavigationMenu_trigger vocs_NavigationMenu_link" style="--vocs_NavigationMenu_chevronDownIcon:url(/.vocs/icons/chevron-down.svg)" data-radix-collection-item="">Support</button></li></ul></div></nav></div><div class="vocs_DesktopTopNav_divider vocs_DesktopTopNav_hideCompact"></div></div></div><div class="vocs_MobileTopNav"><div class="vocs_MobileTopNav_section"><div class="vocs_MobileTopNav_group"><div class="vocs_MobileTopNav_logo"><a style="align-items:center;display:flex;height:100%" href="/"><img alt="Logo" class="vocs_NavLogo_logoImage vocs_Logo vocs_Logo_logoDark" src="/img/sequence-composite-dark.svg"/><img alt="Logo" class="vocs_NavLogo_logoImage vocs_Logo vocs_Logo_logoLight" src="/img/sequence-composite-light.svg"/></a></div></div><div class="vocs_MobileTopNav_group"><nav aria-label="Main" data-orientation="horizontal" dir="ltr" class="vocs_MobileTopNav_navigation vocs_NavigationMenu"><div style="position:relative"><ul data-orientation="horizontal" class="vocs_NavigationMenu_list" dir="ltr"><li class="vocs_MobileTopNav_item vocs_NavigationMenu_item"><button id="radix-:Rcpj:-trigger-radix-:R3cpj:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rcpj:-content-radix-:R3cpj:" data-active="false" class="vocs_NavigationMenu_trigger vocs_NavigationMenu_link" style="--vocs_NavigationMenu_chevronDownIcon:url(/.vocs/icons/chevron-down.svg)" data-radix-collection-item="">Solutions</button></li><li class="vocs_MobileTopNav_item vocs_NavigationMenu_item"><button id="radix-:Rcpj:-trigger-radix-:R5cpj:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rcpj:-content-radix-:R5cpj:" data-active="false" class="vocs_NavigationMenu_trigger vocs_NavigationMenu_link" style="--vocs_NavigationMenu_chevronDownIcon:url(/.vocs/icons/chevron-down.svg)" data-radix-collection-item="">Resources</button></li><li class="vocs_MobileTopNav_item vocs_NavigationMenu_item"><button id="radix-:Rcpj:-trigger-radix-:R7cpj:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rcpj:-content-radix-:R7cpj:" data-active="false" class="vocs_NavigationMenu_trigger vocs_NavigationMenu_link" style="--vocs_NavigationMenu_chevronDownIcon:url(/.vocs/icons/chevron-down.svg)" data-radix-collection-item="">SDKs</button></li><li class="vocs_MobileTopNav_item vocs_NavigationMenu_item"><button id="radix-:Rcpj:-trigger-radix-:R9cpj:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rcpj:-content-radix-:R9cpj:" data-active="false" class="vocs_NavigationMenu_trigger vocs_NavigationMenu_link" style="--vocs_NavigationMenu_chevronDownIcon:url(/.vocs/icons/chevron-down.svg)" data-radix-collection-item="">APIs</button></li><li class="vocs_MobileTopNav_item vocs_NavigationMenu_item"><button id="radix-:Rcpj:-trigger-radix-:Rbcpj:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rcpj:-content-radix-:Rbcpj:" data-active="false" class="vocs_NavigationMenu_trigger vocs_NavigationMenu_link" style="--vocs_NavigationMenu_chevronDownIcon:url(/.vocs/icons/chevron-down.svg)" data-radix-collection-item="">Support</button></li></ul></div></nav><div class="vocs_MobileTopNav_navigation vocs_MobileTopNav_navigation_compact"></div></div></div><div class="vocs_MobileTopNav_section"><div class="vocs_MobileTopNav_group" style="margin-right:-8px"><button class="vocs_MobileSearch_searchButton" type="button" aria-label="Search" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R39j:" data-state="closed"><svg width="21" height="21" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 6.5C10 8.433 8.433 10 6.5 10C4.567 10 3 8.433 3 6.5C3 4.567 4.567 3 6.5 3C8.433 3 10 4.567 10 6.5ZM9.30884 10.0159C8.53901 10.6318 7.56251 11 6.5 11C4.01472 11 2 8.98528 2 6.5C2 4.01472 4.01472 2 6.5 2C8.98528 2 11 4.01472 11 6.5C11 7.56251 10.6318 8.53901 10.0159 9.30884L12.8536 12.1464C13.0488 12.3417 13.0488 12.6583 12.8536 12.8536C12.6583 13.0488 12.3417 13.0488 12.1464 12.8536L9.30884 10.0159Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></button></div></div></div></div><div class="vocs_DocsLayout_gutterTopCurtain vocs_DocsLayout_gutterTopCurtain_withSidebar"><div class="vocs_DesktopTopNav_curtain"></div><div class="vocs_MobileTopNav_curtain"><div class="vocs_MobileTopNav_curtainGroup"><div class="vocs_MobileTopNav_curtainItem"><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:Rqj:" data-state="closed" class="vocs_MobileTopNav_menuTrigger"><div aria-label="Menu" class="vocs_Icon" role="img" style="--vocs_Icon_size:13px"><svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 79 48" fill="none"><title>Menu</title><path fill="currentColor" d="M19.528 47.232h40.87c1.952 0 3.515-1.562 3.515-3.564a3.5 3.5 0 0 0-3.516-3.516H19.528a3.501 3.501 0 0 0-3.515 3.516c0 2.002 1.562 3.564 3.515 3.564ZM12.057 27.262h55.81a3.501 3.501 0 0 0 3.516-3.516 3.501 3.501 0 0 0-3.515-3.515h-55.81a3.501 3.501 0 0 0-3.516 3.515 3.501 3.501 0 0 0 3.515 3.516ZM4.391 7.34H75.29c2.002 0 3.515-1.563 3.515-3.516 0-2.002-1.513-3.564-3.515-3.564H4.39C2.438.26.876 1.822.876 3.824A3.501 3.501 0 0 0 4.39 7.34Z"></path></svg></div><div class="vocs_MobileTopNav_menuTitle">Build a Collectible Minting Service</div></button></div></div><div class="vocs_MobileTopNav_curtainGroup"><div class="vocs_MobileTopNav_curtainItem"><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R5aj:" data-state="closed" class="vocs_MobileTopNav_outlineTrigger">On this page<div aria-label="On this page" class="vocs_Icon" role="img" style="--vocs_Icon_size:10px"><svg width="100%" height="100%" viewBox="0 0 39 69" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Chevron Right</title><path d="M38.8697 34.7461C38.8697 33.6719 38.4791 32.6953 37.649 31.8652L7.47318 1.8848C6.74078 1.1035 5.76418 0.712891 4.64118 0.712891C2.34618 0.712891 0.588379 2.42189 0.588379 4.71679C0.588379 5.79099 1.07668 6.81639 1.76028 7.59769L29.0552 34.7461L1.76028 61.8945C1.07668 62.6758 0.588379 63.6523 0.588379 64.7754C0.588379 67.0703 2.34618 68.7793 4.64118 68.7793C5.76418 68.7793 6.74078 68.3887 7.47318 67.6074L37.649 37.627C38.4791 36.7969 38.8697 35.8203 38.8697 34.7461Z" fill="currentColor"></path></svg></div></button></div></div></div></div><div class="vocs_DocsLayout_gutterRight vocs_DocsLayout_gutterRight_withSidebar"></div><div id="vocs-content" class="vocs_DocsLayout_content vocs_DocsLayout_content_withSidebar vocs_DocsLayout_content_withTopNav"><article class="vocs_Content"><header class="vocs_Header"><h1 class="vocs_H1 vocs_Heading"><div id="mint-collectibles-using-a-gasless-serverless-transactions-api" class="vocs_Heading_slugTarget"></div>Mint Collectibles Using a Gasless Serverless Transactions API<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#mint-collectibles-using-a-gasless-serverless-transactions-api"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h1></header>
<p class="vocs_Paragraph">Time to complete: 20-30 minutes</p>
<p class="vocs_Paragraph">The Sequence Transactions API can be implemented on a serverless <a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined vocs_ExternalLink" href="https://cloudflare.com/" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">Cloudflare</a> worker so a game or app user interaction is seamless without a confirmation signature or gas payment. You&#x27;ll also benefit from not having to be worried about transaction speed, throughput and re-orgs by the relayer, and experience automatic scaling with Cloudflare.</p>
<p class="vocs_Paragraph">The following steps will guide you through how to build your hosted minter API in 4 steps:</p>
<ol class="vocs_List vocs_List_ordered">
<li class="vocs_ListItem"><a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined" href="/guides/mint-collectibles-serverless#1-setup-cloudflare-environment-with-wrangler-cli-and-deploy-a-test">Setup Cloudflare Environment with Wrangler Cli and Deploy a Test</a></li>
<li class="vocs_ListItem"><a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined" href="/guides/mint-collectibles-serverless#2-deploy-sponsor-and-update-metadata-for-an-erc1155-contract-with-sequence-builder">Deploy, Sponsor &amp; Update Metadata for an ERC1155 Contract with Sequence Builder</a></li>
<li class="vocs_ListItem"><a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined" href="/guides/mint-collectibles-serverless#use-ethauthproof-to-prevent-eoa-ddos">Use EthAuthProof to Prevent EOA DDoS</a></li>
<li class="vocs_ListItem"><a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined" href="/guides/mint-collectibles-serverless#4-mint-a-collectible-to-wallet">Mint a Collectible to Wallet</a></li>
</ol>
<p class="vocs_Paragraph">The result, a secure API with the following specs:</p>
<ul class="vocs_List vocs_List_unordered">
<li class="vocs_ListItem">HTTPS GET: returns blockNumber</li>
<li class="vocs_ListItem">HTTPS POST(proof, address): mints a collectible &amp; returns transaction hash</li>
</ul>
<aside class="vocs_Callout vocs_Callout_danger"><p class="vocs_Paragraph">You need basic knowledge of wrangler cli, npm, and Sequence Builder in order to complete this implementation.</p></aside>
<aside class="vocs_Callout vocs_Callout_info"><p class="vocs_Paragraph"><a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined vocs_ExternalLink" href="https://github.com/0xsequence-demos/template-cloudflare-worker-sequence-transactions-api" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">Browse the full code here</a></p></aside>
<h2 class="vocs_H2 vocs_Heading"><div id="1-setup-cloudflare-environment-with-wrangler-cli-and-deploy-a-test" class="vocs_Heading_slugTarget"></div>1. Setup Cloudflare Environment With Wrangler Cli and Deploy a Test<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#1-setup-cloudflare-environment-with-wrangler-cli-and-deploy-a-test"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h2>
<p class="vocs_Paragraph">In order to create the project from scratch, first create a project with <code class="vocs_Code">mkdir</code>, <code class="vocs_Code">cd</code> into the project, and run <code class="vocs_Code">pnpm init</code> to create a <code class="vocs_Code">package.json</code>.</p>
<p class="vocs_Paragraph">Next, make sure wrangler cli is installed in your project and set the <code class="vocs_Code">wrangler</code> keyword as an alias in your local bash session.</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">pnpm</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> install</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> wrangler</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> --save-dev</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">alias</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> wrangler</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">=</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&#x27;./node_modules/.bin/wrangler&#x27;</span></span></code></pre></div></div>
<p class="vocs_Paragraph">Create an account on the <a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined vocs_ExternalLink" href="https://cloudflare.com/" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">Cloudflare site</a> and perform a login step to login to your Cloudflare dashboard to connect the Cloudflare platform to your local development environment.</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">wrangler</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> login</span></span></code></pre></div></div>
<p class="vocs_Paragraph">Once logged in, initialize the project in the directory by accepting one of the randomly generated project folder names provided that you like, and follow the prompts to initialize your git tracked typescript <code class="vocs_Code">&quot;Hello World&quot; Worker</code> application.</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">wrangler</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> init</span></span></code></pre></div></div>
<p class="vocs_Paragraph">To complete this step, you should press enter 4 times after <code class="vocs_Code">wrangler init</code> with the last 2 step answered as <code class="vocs_Code">No</code> to decline git versioning and deployment.</p>
<p class="vocs_Paragraph">This will clone down a starter repository that can be used to deploy code to the cloud.</p>
<aside class="vocs_Callout vocs_Callout_info"><p class="vocs_Paragraph">Local API Testing <br/>
At any point in the guide, you can use the <code class="vocs_Code">wrangler dev</code> command in the project folder for local testing</p></aside>
<h4 class="vocs_H4 vocs_Heading"><div id="deploy-test" class="vocs_Heading_slugTarget"></div>Deploy Test<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#deploy-test"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h4>
<p class="vocs_Paragraph">Finally, <code class="vocs_Code">cd</code> into the randomly generated project folder, and perform a <code class="vocs_Code">wrangler deploy</code> command.</p>
<p class="vocs_Paragraph">This should print a URL, which you can enter in the browser the URL <code class="vocs_Code">https://&lt;app&gt;.&lt;account&gt;.workers.dev</code> to view the <code class="vocs_Code">Hello World!</code> result.</p>
<h2 class="vocs_H2 vocs_Heading"><div id="2-deploy-sponsor-and-update-metadata-for-an-erc1155-contract-with-sequence-builder" class="vocs_Heading_slugTarget"></div>2. Deploy, Sponsor and Update Metadata for an ERC1155 Contract with Sequence Builder<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#2-deploy-sponsor-and-update-metadata-for-an-erc1155-contract-with-sequence-builder"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h2>
<aside class="vocs_Callout"><p class="vocs_Paragraph">To use the Transactions API, you&#x27;ll need to upgrade your Billing to <code class="vocs_Code">Developer</code> for your project in Sequence Builder which can be with <a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined" href="/support/builder/project-settings#5-billing-settings">this walkthrough</a></p></aside>
<p class="vocs_Paragraph">First, follow <a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined" href="/solutions/collectibles/contracts/deploy-an-item-collection">this guide</a> to deploy a contract.</p>
<p class="vocs_Paragraph">Then, one must update the role access of the contract in the Builder to only receive requests from the minter wallet address, which can be done in 2 steps.</p>
<p class="vocs_Paragraph">You can do this in Sequence Builder by providing <code class="vocs_Code">minter permission</code> to your <code class="vocs_Code">Sequence Wallet Transactions API Address</code>.</p>
<p class="vocs_Paragraph">In order to know what the transactions API address you are working with is, one must first either:</p>
<ol class="vocs_List vocs_List_ordered">
<li class="vocs_ListItem">Have one generated for you using this <a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined vocs_ExternalLink" href="https://sequence-ethauthproof-viewer.vercel.app/" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">app</a> by selecting your network, and generating a wallet key with the <code class="vocs_Code">generate local wallet</code> button (for demo purposes only)</li>
<li class="vocs_ListItem"><code class="vocs_Code">Recommended</code>: You can also print locally the account address produced from an EOA wallet private key using the following code snippet:</li>
</ol>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">import</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> { Session } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">from</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;@0xsequence/auth&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">import</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> { ethers } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">from</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;ethers&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">async</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> () </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">=&gt;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">  // Generate a new EOA</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">  // const wallet = ethers.Wallet.createRandom()</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">  // const privateKey = wallet.privateKey</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">  // Or, use an existing EOA private key</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> privateKey</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> provider</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> ethers.providers.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">JsonRpcProvider</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">    &quot;https://nodes.sequence.app/mainnet&quot;</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  );</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">  // Create your server EOA</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> walletEOA</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> ethers.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">Wallet</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(privateKey, provider);</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">  // Open a Sequence session, this will find or create</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">  // a Sequence wallet controlled by your server EOA</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> session</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> Session.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">singleSigner</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">({</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    signer: walletEOA,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    projectAccessKey: </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;access_key&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  });</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> signer</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> session.account.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">getSigner</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">1</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  console.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">log</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">`Your transactions API wallet address: ${</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">signer</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">account</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">address</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">})();</span></span></code></pre></div></div>
<p class="vocs_Paragraph">To do so, open your project, navigate to the <code class="vocs_Code">Contracts</code> page, select your <code class="vocs_Code">Linked contracts</code> and under <code class="vocs_Code">Write Contract</code> tab expand the <code class="vocs_Code">grantRole</code> method.</p>
<p class="vocs_Paragraph">Complete with the following details:</p>
<p class="vocs_Paragraph"><code class="vocs_Code">bytes32 role</code>: <code class="vocs_Code">0x9f2df0fed2c77648de5860a4cc508cd0818c85b8b8a1ab4ceeef8d981c8956a6</code></p>
<p class="vocs_Paragraph"><code class="vocs_Code">address account</code>: <code class="vocs_Code">&lt;Generated Sequence Transactions API Wallet Address&gt;</code></p>
<img src="/img/relayer/grant_role.png" alt="Grant a role for the relayer"/>
<p class="vocs_Paragraph">Where the <code class="vocs_Code">role</code> string inputted is the result of <code class="vocs_Code">keccak256(&quot;MINTER_ROLE&quot;)</code> in solidity or <code class="vocs_Code">ethers.utils.keccak256(ethers.utils.toUtf8Bytes(&quot;MINTER_ROLE&quot;))</code> in javascript</p>
<p class="vocs_Paragraph">This makes it so that only your specific address can mint from the contract, it will error otherwise.</p>
<p class="vocs_Paragraph">Complete the role update by clicking <code class="vocs_Code">write</code> and sign the sponsored transaction.</p>
<h4 class="vocs_H4 vocs_Heading"><div id="update-metadata" class="vocs_Heading_slugTarget"></div>Update Metadata<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#update-metadata"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h4>
<p class="vocs_Paragraph">Next, you&#x27;ll need to update the metadata with your media or assets for your contract, which can be done by <a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined" href="/solutions/collectibles/metadata/manage-metadata-builder">following this guide</a>.</p>
<h4 class="vocs_H4 vocs_Heading"><div id="contract-sponsoring" class="vocs_Heading_slugTarget"></div>Contract Sponsoring<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#contract-sponsoring"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h4>
<p class="vocs_Paragraph">Finally, in order to sponsor the contract follow <a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined" href="/solutions/builder/gas-tank">this guide</a> to sponsor a contract.</p>
<h2 class="vocs_H2 vocs_Heading"><div id="3-use-ethauthproof-to-prevent-eoa-ddos" class="vocs_Heading_slugTarget"></div>3. Use EthAuthProof to prevent EOA DDoS<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#3-use-ethauthproof-to-prevent-eoa-ddos"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h2>
<p class="vocs_Paragraph">Now that we have a contract deployed, we can return to the cloudflare worker directory and project, and install <code class="vocs_Code">ethers</code> and <code class="vocs_Code">0xsequence</code> to get access to sequence APIs in order to perform a proof validation that the request is coming from a trusted source, a sequence wallet.</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">pnpm</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> install</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> 0xsequence</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> @0xsequence/network</span></span></code></pre></div></div>
<p class="vocs_Paragraph">Then, we have to add a type of middleware, after we check if it&#x27;s a POST or GET request. If it&#x27;s a POST request, verify that the passed in <code class="vocs_Code">proofString</code> and <code class="vocs_Code">address</code> are valid, as well as the environment variables.</p>
<p class="vocs_Paragraph">The code scaffold placed into <code class="vocs_Code">src/index.ts</code> would look like this, with <code class="vocs_Code">callContract</code> and <code class="vocs_Code">getBlockNumber</code> mocked out, using the mentioned verification step of calling <code class="vocs_Code">verify</code> before any contract call.</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">import</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> { sequence } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">from</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;0xsequence&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">import</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> { networks, findSupportedNetwork } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">from</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;@0xsequence/network&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">export</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> interface</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Env</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  PKEY</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">; </span><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">// Private key for EOA wallet</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  CONTRACT_ADDRESS</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">; </span><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">// Deployed ERC1155 or ERC721 contract address</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  PROJECT_ACCESS_KEY</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">; </span><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">// From sequence.build</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  CHAIN_HANDLE</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">; </span><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">// Standardized chain name – See https://docs.sequence.xyz/multi-chain-support</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">}</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">// use the sequence api to verify proof came from a sequence wallet</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">const</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> verify</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> async</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  chainId</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  walletAddress</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  ethAuthProofString</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Promise</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&lt;</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Boolean</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&gt; </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">=&gt;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> api</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> sequence.api.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">SequenceAPIClient</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;https://api.sequence.app&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  const</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> { </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">isValid</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">=</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> api.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">isValidETHAuthProof</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">({</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    chainId,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    walletAddress,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    ethAuthProofString,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  });</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  return</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> isValid;</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">};</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">async</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> function</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> handleRequest</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  request</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Request</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  env</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Env</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  ctx</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> ExecutionContext</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Promise</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&lt;</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&gt; {</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  if</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (request.method </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">===</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;OPTIONS&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">) {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">		return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">null</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">			headers: {</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">				// Allow requests from any origin - adjust this as necessary</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">				&quot;Access-Control-Allow-Origin&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">: </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;*&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">				</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">				// Allows the headers Content-Type, your-custom-header</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">				&quot;Access-Control-Allow-Headers&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">: </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;Content-Type, your-custom-header&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">				</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">				// Allow POST method - add any other methods you need to support</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">				&quot;Access-Control-Allow-Methods&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">: </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;POST&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">				</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">				// Optional: allow credentials</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">				&quot;Access-Control-Allow-Credentials&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">: </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;true&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">				</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">				// Preflight cache period</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">				&quot;Access-Control-Max-Age&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">: </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;86400&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, </span><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">// 24 hours</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">			}</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">		});</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">	}</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  if</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">PKEY</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ===</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> undefined</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ||</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">PKEY</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ===</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">) {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;Make sure PKEY is configured in your environment&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">      status: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">400</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    });</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  }</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  if</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CONTRACT_ADDRESS</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ===</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> undefined</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ||</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CONTRACT_ADDRESS</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ===</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">) {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">      &quot;Make sure CONTRACT_ADDRESS is configured in your environment&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">      { status: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">400</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> }</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    );</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  }</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  if</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">PROJECT_ACCESS_KEY</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ===</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> undefined</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ||</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">PROJECT_ACCESS_KEY</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ===</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">) {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">      &quot;Make sure PROJECT_ACCESS_KEY is configured in your environment&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">      { status: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">400</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> }</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    );</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  }</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  if</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CHAIN_HANDLE</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ===</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> undefined</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ||</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CHAIN_HANDLE</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> ===</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">) {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">      &quot;Make sure CHAIN_HANDLE is configured in your environment&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">      { status: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">400</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> }</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    );</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  }</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> chainConfig</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> findSupportedNetwork</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CHAIN_HANDLE</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  if</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (chainConfig </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">===</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> undefined</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">) {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;Unsupported network or unknown CHAIN_HANDLE&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">      status: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">400</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    });</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  }</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">  // POST request</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  if</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (request.method </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">===</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &quot;POST&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">) {</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">    // parse the request body as JSON</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> body</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> request.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">json</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">();</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    const</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> { </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">proof</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">address</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">tokenId</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> }</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> any</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> body;</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    try</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">      // check that the proof is valid</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">      if</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">await</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> verify</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CHAIN_HANDLE</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, address, proof)) {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">        try</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">          // mocked call</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">          const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> res</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> callContract</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(request, env, address, tokenId);</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">          return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">`${</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">res</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">hash</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, { status: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">200</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> });</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">        } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">catch</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (</span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">err</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> any</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">) {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">          console.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">log</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(err);</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">          return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">`Something went wrong: ${</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">JSON</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">stringify</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">(</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">err</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">)</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">            status: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">400</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">          });</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">        }</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">      } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">else</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">        return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">`Unauthorized`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, { status: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">401</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> });</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">      }</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">catch</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (</span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">err</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> any</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">) {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">      return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">`Unauthorized ${</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">JSON</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">stringify</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">(</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">err</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">)</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">        status: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">401</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">      });</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    }</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  }</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">  // GET request</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  else</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    try</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">      // mocked call</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">      const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> res</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> getBlockNumber</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CHAIN_HANDLE</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, request);</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">      return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">`Block Number: ${</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">res</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">catch</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (</span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">err</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> any</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">) {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">      return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> Response</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">`Something went wrong: ${</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">JSON</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">stringify</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">(</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">err</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">)</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">        status: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">500</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">      });</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    }</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  }</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">}</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">const</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> getBlockNumber</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> async</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  chainId</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  request</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Request</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Promise</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&lt;</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">number</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&gt; </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">=&gt;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  return</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> chainId;</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">};</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">const</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> callContract</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> async</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  request</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Request</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  env</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Env</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  address</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">  tokenId</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> number</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Promise</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&lt;</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">ethers</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">.</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">providers</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">.</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">TransactionResponse</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&gt; </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">=&gt;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  return</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> { hash: </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;0x&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">as</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> any</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">};</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">export</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> default</span><span style="color:#24292E;--shiki-dark:#F69D50" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">  async</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> fetch</span><span style="color:#24292E;--shiki-dark:#F69D50" class="vocs_Span">(</span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">request</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Request</span><span style="color:#24292E;--shiki-dark:#F69D50" class="vocs_Span">, </span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">env</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Env</span><span style="color:#24292E;--shiki-dark:#F69D50" class="vocs_Span">, </span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">ctx</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> ExecutionContext</span><span style="color:#24292E;--shiki-dark:#F69D50" class="vocs_Span">) </span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">{</span></span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">    // Process the request and create a response</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> response</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> handleRequest</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(request, env, ctx);</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">    // Set CORS headers</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    response.headers.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">set</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;Access-Control-Allow-Origin&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;*&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    response.headers.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">set</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">      &quot;Access-Control-Allow-Methods&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">      &quot;GET, POST, PUT, DELETE, OPTIONS&quot;</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    );</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">    response.headers.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">set</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;Access-Control-Allow-Headers&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;Content-Type&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">);</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">    // return response</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    return</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> response;</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">  }</span><span style="color:#24292E;--shiki-dark:#F69D50" class="vocs_Span">,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#F69D50" class="vocs_Span">}</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">;</span></span></code></pre></div></div>
<h4 class="vocs_H4 vocs_Heading"><div id="add-cloudflare-environment-variables" class="vocs_Heading_slugTarget"></div>Add Cloudflare Environment Variables<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#add-cloudflare-environment-variables"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h4>
<p class="vocs_Paragraph">Then, pass in the environment variables for your build by updating the <code class="vocs_Code">[vars]</code> section in your <code class="vocs_Code">wrangler.toml</code>.</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span class="vocs_Span">[vars]</span></span>
<span class="line vocs_Span"><span class="vocs_Span">PKEY = &quot;&quot; # Private key for EOA wallet</span></span>
<span class="line vocs_Span"><span class="vocs_Span">CONTRACT_ADDRESS = &quot;&quot; # // Deployed ERC1155 or ERC721 contract address</span></span>
<span class="line vocs_Span"><span class="vocs_Span">PROJECT_ACCESS_KEY = &quot;&quot; # From sequence.build</span></span>
<span class="line vocs_Span"><span class="vocs_Span">CHAIN_HANDLE = &quot;&quot; # // Standardized chain name – See https://docs.sequence.xyz/multi-chain-support</span></span></code></pre></div></div>
<h4 class="vocs_H4 vocs_Heading"><div id="implement-window-object-in-wrangler-template" class="vocs_Heading_slugTarget"></div>Implement Window Object in Wrangler Template<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#implement-window-object-in-wrangler-template"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h4>
<p class="vocs_Paragraph">It should be noted, if you try to deploy this you&#x27;ll get a missing <code class="vocs_Code">window</code> object required by the web3 modules.</p>
<p class="vocs_Paragraph">To prevent this, add the following line to your <code class="vocs_Code">wrangler.toml</code> file to make the environment compatible.</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span class="vocs_Span">...</span></span>
<span class="line vocs_Span"><span class="vocs_Span">node_compat = true # add this line</span></span>
<span class="line vocs_Span"><span class="vocs_Span">...</span></span></code></pre></div></div>
<h4 class="vocs_H4 vocs_Heading"><div id="testing-the-deploy" class="vocs_Heading_slugTarget"></div>Testing the Deploy<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#testing-the-deploy"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h4>
<p class="vocs_Paragraph">You can now redeploy using <code class="vocs_Code">wrangler deploy</code></p>
<p class="vocs_Paragraph">And perform a curl request to test your endpoint like such:</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">curl</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> -X</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> POST</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> https://your-worker.your-subdomain.workers.dev</span><span style="color:#005CC5;--shiki-dark:#F47067" class="vocs_Span"> \</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">-H </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;Content-Type: application/json&quot;</span><span style="color:#005CC5;--shiki-dark:#F47067" class="vocs_Span"> \</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">-d </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&#x27;{&quot;proof&quot;: &quot;&lt;some_proof&gt;&quot;, &quot;address&quot;: &quot;&lt;some_address&gt;&quot;, &quot;tokenId&quot;: 0 }&#x27;</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">...</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> invalid</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> proof</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> string</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> ...</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span"># and if you replace with actual proof (from a wallet client login) and address on polygon, it should return</span></span>
<span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">success</span></span></code></pre></div></div>
<p class="vocs_Paragraph">You can acquire your wallet address proof by using this <a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined vocs_ExternalLink" href="https://sequence-ethauthproof-viewer.vercel.app/" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">dapp</a> and follow the below steps.</p>
<h4 class="vocs_H4 vocs_Heading"><div id="using-the-ethauthproof-viewer-dapp" class="vocs_Heading_slugTarget"></div>Using the ETHAuthProof Viewer dapp<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#using-the-ethauthproof-viewer-dapp"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h4>
<p class="vocs_Paragraph">When you arrive on the page, the first thing you should do is select a network.</p>
<p class="vocs_Paragraph">Then you have an option to either connect and generate the Proof, or, generate a local wallet</p>
<p class="vocs_Paragraph"><img src="/img/relayer/ethauthproof_viewer_connect.png" alt="ETHAuthProof Viewer"/></p>
<p class="vocs_Paragraph">Press the <code class="vocs_Code">connect</code> button and then <code class="vocs_Code">copy to clipboard</code>.</p>
<p class="vocs_Paragraph"><img src="/img/relayer/ethauthproof_viewer_copy.png" alt="ETHAuthProof Viewer copy to clipboard"/></p>
<p class="vocs_Paragraph">It should be noted, it is best not to share this <code class="vocs_Code">ETHAuthProof</code> with anyone as this means someone can prove ownership of your wallet and interact with specific APIs.</p>
<p class="vocs_Paragraph">Finally, replace the <code class="vocs_Code">url</code> with your app from <a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined" href="/guides/mint-collectibles-serverless#deploy-test">this step</a>, the <code class="vocs_Code">&lt;some_proof&gt;</code> with the generated value copied from the viewer dapp, and <code class="vocs_Code">&lt;some_address&gt;</code> with your wallet address and it should return just the mocked <code class="vocs_Code">0x</code> string.</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">curl</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> -X</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> POST</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> https://your-worker.your-subdomain.workers.dev</span><span style="color:#005CC5;--shiki-dark:#F47067" class="vocs_Span"> \</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">-H </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;Content-Type: application/json&quot;</span><span style="color:#005CC5;--shiki-dark:#F47067" class="vocs_Span"> \</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">-d </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&#x27;{&quot;proof&quot;: &quot;&lt;some_proof&gt;&quot;, &quot;address&quot;: &quot;&lt;some_address&gt;&quot;, &quot;tokenId&quot;: 0 }&#x27;</span></span></code></pre></div></div>
<h2 class="vocs_H2 vocs_Heading"><div id="4-mint-a-collectible-to-wallet" class="vocs_Heading_slugTarget"></div>4. Mint a Collectible to Wallet<a class="vocs_Anchor vocs_Autolink" aria-hidden="true" tabindex="-1" href="/guides/mint-collectibles-serverless#4-mint-a-collectible-to-wallet"><div data-autolink-icon="true" class="vocs_Div vocs_AutolinkIcon" style="--vocs_AutolinkIcon_iconUrl:url(/.vocs/icons/link.svg)"></div></a></h2>
<p class="vocs_Paragraph">Finally, to deploy and mint a collectible from the sponsored contract address, we install the following packages</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">pnpm</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> install</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> @0xsequence/auth</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> ethers@5.7.2</span></span></code></pre></div></div>
<p class="vocs_Paragraph">and implement the <code class="vocs_Code">callContract</code> and <code class="vocs_Code">getBlockNumber</code> methods previously mocked out as follows:</p>
<div class="vocs_CodeBlock"><div class="vocs_Pre_wrapper"><pre style="background-color:#fff;--shiki-dark-bg:#22272e;color:#24292e;--shiki-dark:#adbac7" tabindex="0" class="shiki shiki-themes github-light github-dark-dimmed vocs_Pre"><code class="vocs_Code"><span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">import</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> { ethers } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">from</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &#x27;ethers&#x27;</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">import</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> { Session, SessionSettings } </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">from</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> &#x27;@0xsequence/auth&#x27;</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">...</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">const</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> getBlockNumber</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> async</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (</span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">chainId</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, </span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">request</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Request</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Promise</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&lt;</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">number</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&gt; </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">=&gt;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> nodeUrl</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> `https://nodes.sequence.app/${</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">chainId</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> provider</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> ethers.providers.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">JsonRpcProvider</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">({ url: nodeUrl, skipFetchSetup: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">true</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> })</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> provider.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">getBlockNumber</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">()</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">}</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">const</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span"> callContract</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> async</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (</span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">request</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Request</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, </span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">env</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Env</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, </span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">address</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> string</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, </span><span style="color:#E36209;--shiki-dark:#F69D50" class="vocs_Span">tokenId</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> number</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Promise</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&lt;</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">ethers</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">.</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">providers</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">.</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">TransactionResponse</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&gt; </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">=&gt;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> nodeUrl</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> `https://nodes.sequence.app/${</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">env</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CHAIN_HANDLE</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}`</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> relayerUrl</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span"> `https://{</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">env</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CHAIN_HANDLE</span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">}-relayer.sequence.app`</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> provider</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> ethers.providers.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">JsonRpcProvider</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">({ url: nodeUrl, skipFetchSetup: </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">true</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> })</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">    const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> contractAddress</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CONTRACT_ADDRESS</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">    // create EOA from private key</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> walletEOA</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> ethers.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">Wallet</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">PKEY</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, provider);</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">	// instantiate settings</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> settings</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">:</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span"> Partial</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&lt;</span><span style="color:#6F42C1;--shiki-dark:#F69D50" class="vocs_Span">SessionSettings</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">&gt; </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">=</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">		networks: [{</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">			...</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">networks[</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">findSupportedNetwork</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CHAIN_HANDLE</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">!</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">.chainId],</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">			rpcUrl: </span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">findSupportedNetwork</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CHAIN_HANDLE</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">!</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">.rpcUrl,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">			provider: provider,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">			relayer: {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">				url: relayerUrl,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">				provider: {</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">					url: </span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">findSupportedNetwork</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CHAIN_HANDLE</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">!</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">.rpcUrl</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">				}</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">			}</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">		}],</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">	}</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">    // create a single signer sequence wallet session</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> session</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> Session.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">singleSigner</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">({</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">		settings: settings,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">		signer: walletEOA,</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">		projectAccessKey: env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">PROJECT_ACCESS_KEY</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">	})</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">	// get signer</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> signer</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> session.account.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">getSigner</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">findSupportedNetwork</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(env.</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">CHAIN_HANDLE</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">)</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">!</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">.chainId)</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">	// create interface from partial abi</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> collectibleInterface</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> new</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> ethers.utils.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">Interface</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">([</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">		&#x27;function mint(address to, uint256 tokenId, uint256 amount, bytes data)&#x27;</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">	])</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">	// create calldata</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> data</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> collectibleInterface.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">encodeFunctionData</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(</span></span>
<span class="line vocs_Span"><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">		&#x27;mint&#x27;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, [address, tokenId, </span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span">1</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">, </span><span style="color:#032F62;--shiki-dark:#96D0FF" class="vocs_Span">&quot;0x00&quot;</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">]</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">	)</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#6A737D;--shiki-dark:#768390" class="vocs_Span">	// create transaction object</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	const</span><span style="color:#005CC5;--shiki-dark:#6CB6FF" class="vocs_Span"> txn</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> =</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> { to: contractAddress, data }</span></span>
<span class="line vocs_Span" data-empty-line="true"> </span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">	try</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">		return</span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span"> await</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> signer.</span><span style="color:#6F42C1;--shiki-dark:#DCBDFB" class="vocs_Span">sendTransaction</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">(txn)</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">	} </span><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">catch</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> (err) {</span></span>
<span class="line vocs_Span"><span style="color:#D73A49;--shiki-dark:#F47067" class="vocs_Span">		throw</span><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span"> err</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">	}</span></span>
<span class="line vocs_Span"><span style="color:#24292E;--shiki-dark:#ADBAC7" class="vocs_Span">}</span></span></code></pre></div></div>
<p class="vocs_Paragraph">Once these steps are complete, you can redeploy and test with the steps outlined in this <a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined" href="/guides/mint-collectibles-serverless#testing">prior step</a>, and this time the POST request should return a transaction hash for the completed mint and the GET request would return a block number.</p>
<p class="vocs_Paragraph">If you want to browse the full code, see <a class="vocs_Anchor vocs_Link vocs_Link_accent_underlined vocs_ExternalLink" href="https://github.com/0xsequence-demos/cloudflare-worker-sequence-transactions-api" target="_blank" rel="noopener noreferrer" style="--vocs_ExternalLink_iconUrl:url(/.vocs/icons/arrow-diagonal.svg)">an example implementation here</a></p></article><footer class="vocs_Footer"><div class="vocs_Footer_container"></div><div></div></footer></div><div data-bottom-observer="true"></div></div></div>
  </body>
</html>
